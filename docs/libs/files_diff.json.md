# Crate Documentation

**Version:** 0.1.1

**Format Version:** 43

# Module `files_diff`

A library for generating and applying binary diffs between files and
archives.

This library provides efficient differing algorithms to generate patches
between binary files or zip archives. It supports multiple differing
algorithms (rsync and bidiff) and compression methods to optimize patch
sizes.

# Basic Usage
```rust
use files_diff::{diff, apply, DEFAULT_ALGO};

let before = b"hello world";
let after = b"hello darkness my old friend";

// Generate a patch using default algorithms
let (diff_algo, compress_algo) = DEFAULT_ALGO;
let patch = diff(before, after, diff_algo, compress_algo)?;

// Apply the patch to recreate the target file
let result = apply(before, &patch)?;
assert_eq!(&result, after);
# Ok::<(), files_diff::Error>(())
```

# Advanced Usage
```no_run
use files_diff::{diff_zip, apply_zip, DiffAlgorithm, CompressAlgorithm};

// For zip archives, use the specialized zip functions
let patch_set = diff_zip(
    "before.zip".to_string(),
    "after.zip".to_string(),
    DiffAlgorithm::Bidiff1,
    CompressAlgorithm::Zstd
)?;

// Apply patches to transform the original zip
apply_zip("before.zip", patch_set, "result.zip".to_string())?;
# Ok::<(), files_diff::Error>(())
```

The library uses [fast-rsync] for the rsync algorithm and [bidiff] for the
bidiff algorithm. Each patch includes hash validation to ensure data
integrity during the patching process.

[fast-rsync]: https://github.com/dropbox/fast-rsync
[bidiff]: https://github.com/divvun/bidiff

## Traits

### Trait `DiffMachine`

A trait that implements differing and patching operations.

This trait defines the core operations needed to generate and apply patches
between binary data. Implementations provide specific differing algorithms.

# Example
```no_run
use files_diff::{DiffMachine, CompressAlgorithm, Error, Patch};
struct MyDiffMachine;

impl DiffMachine for MyDiffMachine {
    fn diff(before: &[u8], after: &[u8], compress: CompressAlgorithm) -> Result<Patch, Error> {
        // Implementation details...
        # todo!()
    }
     
    fn apply(base: &[u8], patch: &Patch) -> Result<Vec<u8>, Error> {
        // Implementation details...
        # todo!()
    }
}
```

```rust
pub trait DiffMachine {
    /* Associated items */
}
```

> This trait is not object-safe and cannot be used in dynamic trait objects.

#### Required Items

##### Required Methods

- `diff`: Diff two byte slices using the given compression algorithm.
- `apply`: Apply a patch to a byte slice.

## Functions

### Function `hash`

Generates an MD5 hash of the provided data as a hexadecimal string.

This function is used internally for patch validation to ensure data
integrity.

# Example
```rust
use files_diff::hash;

let data = b"Hello, world!";
let hash_str = hash(data);
assert_eq!(hash_str.len(), 32); // MD5 hash is always 32 hex chars
```

```rust
pub fn hash(data: &[u8]) -> String { /* ... */ }
```

### Function `diff`

Generates a patch between two byte slices using specified algorithms.

Creates a patch that can transform the `before` data into the `after` data,
using the specified diff and compression algorithms.

# Example
```rust
use files_diff::{diff, DiffAlgorithm, CompressAlgorithm};

let before = b"original data";
let after = b"modified data";

let patch = diff(
    before,
    after,
    DiffAlgorithm::Rsync020,
    CompressAlgorithm::Zstd
)?;
# Ok::<(), files_diff::Error>(())
```

```rust
pub fn diff(before: &[u8], after: &[u8], diff_algorithm: DiffAlgorithm, compress_algorithm: CompressAlgorithm) -> Result<Patch, Error> { /* ... */ }
```

### Function `apply`

Applies a patch to transform the base data.

Takes a patch generated by `diff()` and applies it to the base data
to recreate the target data.

# Example
```rust
use files_diff::{diff, apply, DEFAULT_ALGO};

let base = b"original data";
let target = b"modified data";

let (diff_algo, compress_algo) = DEFAULT_ALGO;
let patch = diff(base, target, diff_algo, compress_algo)?;
let result = apply(base, &patch)?;

assert_eq!(result, target);
# Ok::<(), files_diff::Error>(())
```

```rust
pub fn apply(base: &[u8], delta: &Patch) -> Result<Vec<u8>, Error> { /* ... */ }
```

## Constants and Statics

### Constant `DEFAULT_ALGO`

The default diff and compression algorithm.

```rust
pub const DEFAULT_ALGO: (DiffAlgorithm, CompressAlgorithm) = _;
```

## Re-exports

### Re-export `CompressAlgorithm`

```rust
pub use compress::CompressAlgorithm;
```

### Re-export `Error`

```rust
pub use error::Error;
```

### Re-export `DiffAlgorithm`

```rust
pub use patch::DiffAlgorithm;
```

### Re-export `Patch`

```rust
pub use patch::Patch;
```

### Re-export `PatchSet`

```rust
pub use patch::PatchSet;
```

### Re-export `apply_zip`

```rust
pub use zip::apply_zip;
```

### Re-export `diff_zip`

```rust
pub use zip::diff_zip;
```

