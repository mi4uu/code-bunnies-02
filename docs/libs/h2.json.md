# Crate Documentation

**Version:** 0.4.9

**Format Version:** 43

# Module `h2`

An asynchronous, HTTP/2 server and client implementation.

This library implements the [HTTP/2] specification. The implementation is
asynchronous, using [futures] as the basis for the API. The implementation
is also decoupled from TCP or TLS details. The user must handle ALPN and
HTTP/1.1 upgrades themselves.

# Getting started

Add the following to your `Cargo.toml` file:

```toml
[dependencies]
h2 = "0.4"
```

# Layout

The crate is split into [`client`] and [`server`] modules. Types that are
common to both clients and servers are located at the root of the crate.

See module level documentation for more details on how to use `h2`.

# Handshake

Both the client and the server require a connection to already be in a state
ready to start the HTTP/2 handshake. This library does not provide
facilities to do this.

There are three ways to reach an appropriate state to start the HTTP/2
handshake.

* Opening an HTTP/1.1 connection and performing an [upgrade].
* Opening a connection with TLS and use ALPN to negotiate the protocol.
* Open a connection with prior knowledge, i.e. both the client and the
  server assume that the connection is immediately ready to start the
  HTTP/2 handshake once opened.

Once the connection is ready to start the HTTP/2 handshake, it can be
passed to [`server::handshake`] or [`client::handshake`]. At this point, the
library will start the handshake process, which consists of:

* The client sends the connection preface (a predefined sequence of 24
  octets).
* Both the client and the server sending a SETTINGS frame.

See the [Starting HTTP/2] in the specification for more details.

# Flow control

[Flow control] is a fundamental feature of HTTP/2. The `h2` library
exposes flow control to the user.

An HTTP/2 client or server may not send unlimited data to the peer. When a
stream is initiated, both the client and the server are provided with an
initial window size for that stream.  A window size is the number of bytes
the endpoint can send to the peer. At any point in time, the peer may
increase this window size by sending a `WINDOW_UPDATE` frame. Once a client
or server has sent data filling the window for a stream, no further data may
be sent on that stream until the peer increases the window.

There is also a **connection level** window governing data sent across all
streams.

Managing flow control for inbound data is done through [`FlowControl`].
Managing flow control for outbound data is done through [`SendStream`]. See
the struct level documentation for those two types for more details.

[HTTP/2]: https://http2.github.io/
[futures]: https://docs.rs/futures/
[`client`]: client/index.html
[`server`]: server/index.html
[Flow control]: http://httpwg.org/specs/rfc7540.html#FlowControl
[`FlowControl`]: struct.FlowControl.html
[`SendStream`]: struct.SendStream.html
[Starting HTTP/2]: http://httpwg.org/specs/rfc7540.html#starting
[upgrade]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Protocol_upgrade_mechanism
[`server::handshake`]: server/fn.handshake.html
[`client::handshake`]: client/fn.handshake.html

## Modules

## Module `client`

Client implementation of the HTTP/2 protocol.

# Getting started

Running an HTTP/2 client requires the caller to establish the underlying
connection as well as get the connection to a state that is ready to begin
the HTTP/2 handshake. See [here](../index.html#handshake) for more
details.

This could be as basic as using Tokio's [`TcpStream`] to connect to a remote
host, but usually it means using either ALPN or HTTP/1.1 protocol upgrades.

Once a connection is obtained, it is passed to [`handshake`], which will
begin the [HTTP/2 handshake]. This returns a future that completes once
the handshake process is performed and HTTP/2 streams may be initialized.

[`handshake`] uses default configuration values. There are a number of
settings that can be changed by using [`Builder`] instead.

Once the handshake future completes, the caller is provided with a
[`Connection`] instance and a [`SendRequest`] instance. The [`Connection`]
instance is used to drive the connection (see [Managing the connection]).
The [`SendRequest`] instance is used to initialize new streams (see [Making
requests]).

# Making requests

Requests are made using the [`SendRequest`] handle provided by the handshake
future. Once a request is submitted, an HTTP/2 stream is initialized and
the request is sent to the server.

A request body and request trailers are sent using [`SendRequest`] and the
server's response is returned once the [`ResponseFuture`] future completes.
Both the [`SendStream`] and [`ResponseFuture`] instances are returned by
[`SendRequest::send_request`] and are tied to the HTTP/2 stream
initialized by the sent request.

The [`SendRequest::poll_ready`] function returns `Ready` when a new HTTP/2
stream can be created, i.e. as long as the current number of active streams
is below [`MAX_CONCURRENT_STREAMS`]. If a new stream cannot be created, the
caller will be notified once an existing stream closes, freeing capacity for
the caller.  The caller should use [`SendRequest::poll_ready`] to check for
capacity before sending a request to the server.

[`SendRequest`] enforces the [`MAX_CONCURRENT_STREAMS`] setting. The user
must not send a request if `poll_ready` does not return `Ready`. Attempting
to do so will result in an [`Error`] being returned.

# Managing the connection

The [`Connection`] instance is used to manage connection state. The caller
is required to call [`Connection::poll`] in order to advance state.
[`SendRequest::send_request`] and other functions have no effect unless
[`Connection::poll`] is called.

The [`Connection`] instance should only be dropped once [`Connection::poll`]
returns `Ready`. At this point, the underlying socket has been closed and no
further work needs to be done.

The easiest way to ensure that the [`Connection`] instance gets polled is to
submit the [`Connection`] instance to an [executor]. The executor will then
manage polling the connection until the connection is complete.
Alternatively, the caller can call `poll` manually.

# Example

```rust, no_run

use h2::client;

use http::{Request, Method};
use std::error::Error;
use tokio::net::TcpStream;

#[tokio::main]
pub async fn main() -> Result<(), Box<dyn Error>> {
    // Establish TCP connection to the server.
    let tcp = TcpStream::connect("127.0.0.1:5928").await?;
    let (h2, connection) = client::handshake(tcp).await?;
    tokio::spawn(async move {
        connection.await.unwrap();
    });

    let mut h2 = h2.ready().await?;
    // Prepare the HTTP request to send to the server.
    let request = Request::builder()
                    .method(Method::GET)
                    .uri("https://www.example.com/")
                    .body(())
                    .unwrap();

    // Send the request. The second tuple item allows the caller
    // to stream a request body.
    let (response, _) = h2.send_request(request, true).unwrap();

    let (head, mut body) = response.await?.into_parts();

    println!("Received response: {:?}", head);

    // The `flow_control` handle allows the caller to manage
    // flow control.
    //
    // Whenever data is received, the caller is responsible for
    // releasing capacity back to the server once it has freed
    // the data from memory.
    let mut flow_control = body.flow_control().clone();

    while let Some(chunk) = body.data().await {
        let chunk = chunk?;
        println!("RX: {:?}", chunk);

        // Let the server send more data.
        let _ = flow_control.release_capacity(chunk.len());
    }

    Ok(())
}
```

[`TcpStream`]: https://docs.rs/tokio-core/0.1/tokio_core/net/struct.TcpStream.html
[`handshake`]: fn.handshake.html
[executor]: https://docs.rs/futures/0.1/futures/future/trait.Executor.html
[`SendRequest`]: struct.SendRequest.html
[`SendStream`]: ../struct.SendStream.html
[Making requests]: #making-requests
[Managing the connection]: #managing-the-connection
[`Connection`]: struct.Connection.html
[`Connection::poll`]: struct.Connection.html#method.poll
[`SendRequest::send_request`]: struct.SendRequest.html#method.send_request
[`MAX_CONCURRENT_STREAMS`]: http://httpwg.org/specs/rfc7540.html#SettingValues
[`SendRequest`]: struct.SendRequest.html
[`ResponseFuture`]: struct.ResponseFuture.html
[`SendRequest::poll_ready`]: struct.SendRequest.html#method.poll_ready
[HTTP/2 handshake]: http://httpwg.org/specs/rfc7540.html#ConnectionHeader
[`Builder`]: struct.Builder.html
[`Error`]: ../struct.Error.html

```rust
pub mod client { /* ... */ }
```

### Types

#### Struct `SendRequest`

Initializes new HTTP/2 streams on a connection by sending a request.

This type does no work itself. Instead, it is a handle to the inner
connection state held by [`Connection`]. If the associated connection
instance is dropped, all `SendRequest` functions will return [`Error`].

[`SendRequest`] instances are able to move to and operate on separate tasks
/ threads than their associated [`Connection`] instance. Internally, there
is a buffer used to stage requests before they get written to the
connection. There is no guarantee that requests get written to the
connection in FIFO order as HTTP/2 prioritization logic can play a role.

[`SendRequest`] implements [`Clone`], enabling the creation of many
instances that are backed by a single connection.

See [module] level documentation for more details.

[module]: index.html
[`Connection`]: struct.Connection.html
[`Clone`]: https://doc.rust-lang.org/std/clone/trait.Clone.html
[`Error`]: ../struct.Error.html

```rust
pub struct SendRequest<B: Buf> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn poll_ready(self: &mut Self, cx: &mut Context<''_>) -> Poll<Result<(), crate::Error>> { /* ... */ }
  ```
  Returns `Ready` when the connection can initialize a new HTTP/2

- ```rust
  pub fn ready(self: Self) -> ReadySendRequest<B> { /* ... */ }
  ```
  Consumes `self`, returning a future that returns `self` back once it is

- ```rust
  pub fn send_request(self: &mut Self, request: Request<()>, end_of_stream: bool) -> Result<(ResponseFuture, SendStream<B>), crate::Error> { /* ... */ }
  ```
  Sends a HTTP/2 request to the server.

- ```rust
  pub fn is_extended_connect_protocol_enabled(self: &Self) -> bool { /* ... */ }
  ```
  Returns whether the [extended CONNECT protocol][1] is enabled or not.

- ```rust
  pub fn current_max_send_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the current max send streams

- ```rust
  pub fn current_max_recv_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the current max recv streams

###### Trait Implementations

- **ToOwned**
  - ```rust
    fn to_owned(self: &Self) -> T { /* ... */ }
    ```

  - ```rust
    fn clone_into(self: &Self, target: &mut T) { /* ... */ }
    ```

- **Clone**
  - ```rust
    fn clone(self: &Self) -> Self { /* ... */ }
    ```

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Sync**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, fmt: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **Freeze**
- **Send**
- **UnwindSafe**
- **Instrument**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **RefUnwindSafe**
- **CloneToUninit**
  - ```rust
    unsafe fn clone_to_uninit(self: &Self, dest: *mut u8) { /* ... */ }
    ```

- **Unpin**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **WithSubscriber**
#### Struct `ReadySendRequest`

Returns a `SendRequest` instance once it is ready to send at least one
request.

```rust
pub struct ReadySendRequest<B: Buf> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Trait Implementations

- **Freeze**
- **Sync**
- **Send**
- **Unpin**
- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Instrument**
- **UnwindSafe**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **WithSubscriber**
- **IntoFuture**
  - ```rust
    fn into_future(self: Self) -> <F as IntoFuture>::IntoFuture { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **RefUnwindSafe**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **TryFuture**
  - ```rust
    fn try_poll(self: Pin<&mut F>, cx: &mut Context<''_>) -> Poll<<F as Future>::Output> { /* ... */ }
    ```

- **Future**
  - ```rust
    fn poll(self: Pin<&mut Self>, cx: &mut Context<''_>) -> Poll<<Self as >::Output> { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

#### Struct `Connection`

**Attributes:**

- `#[must_use = "futures do nothing unless polled"]`

Manages all state associated with an HTTP/2 client connection.

A `Connection` is backed by an I/O resource (usually a TCP socket) and
implements the HTTP/2 client logic for that connection. It is responsible
for driving the internal state forward, performing the work requested of the
associated handles ([`SendRequest`], [`ResponseFuture`], [`SendStream`],
[`RecvStream`]).

`Connection` values are created by calling [`handshake`]. Once a
`Connection` value is obtained, the caller must repeatedly call [`poll`]
until `Ready` is returned. The easiest way to do this is to submit the
`Connection` instance to an [executor].

[module]: index.html
[`handshake`]: fn.handshake.html
[`SendRequest`]: struct.SendRequest.html
[`ResponseFuture`]: struct.ResponseFuture.html
[`SendStream`]: ../struct.SendStream.html
[`RecvStream`]: ../struct.RecvStream.html
[`poll`]: #method.poll
[executor]: https://docs.rs/futures/0.1/futures/future/trait.Executor.html

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::client;
# use h2::client::*;
#
# async fn doc<T>(my_io: T) -> Result<(), h2::Error>
# where T: AsyncRead + AsyncWrite + Send + Unpin + 'static,
# {
    let (send_request, connection) = client::handshake(my_io).await?;
    // Submit the connection handle to an executor.
    tokio::spawn(async { connection.await.expect("connection failed"); });

    // Now, use `send_request` to initialize HTTP/2 streams.
    // ...
# Ok(())
# }
#
# pub fn main() {}
```

```rust
pub struct Connection<T, B: Buf = bytes::Bytes> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn set_target_window_size(self: &mut Self, size: u32) { /* ... */ }
  ```
  Sets the target window size for the whole connection.

- ```rust
  pub fn set_initial_window_size(self: &mut Self, size: u32) -> Result<(), crate::Error> { /* ... */ }
  ```
  Set a new `INITIAL_WINDOW_SIZE` setting (in octets) for stream-level

- ```rust
  pub fn ping_pong(self: &mut Self) -> Option<PingPong> { /* ... */ }
  ```
  Takes a `PingPong` instance from the connection.

- ```rust
  pub fn max_concurrent_send_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the maximum number of concurrent streams that may be initiated

- ```rust
  pub fn max_concurrent_recv_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the maximum number of concurrent streams that may be initiated

###### Trait Implementations

- **Send**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Debug**
  - ```rust
    fn fmt(self: &Self, fmt: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **Unpin**
- **UnwindSafe**
- **Future**
  - ```rust
    fn poll(self: Pin<&mut Self>, cx: &mut Context<''_>) -> Poll<<Self as >::Output> { /* ... */ }
    ```

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Sync**
- **RefUnwindSafe**
- **IntoFuture**
  - ```rust
    fn into_future(self: Self) -> <F as IntoFuture>::IntoFuture { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **TryFuture**
  - ```rust
    fn try_poll(self: Pin<&mut F>, cx: &mut Context<''_>) -> Poll<<F as Future>::Output> { /* ... */ }
    ```

- **WithSubscriber**
- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Freeze**
- **Instrument**
- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

#### Struct `ResponseFuture`

**Attributes:**

- `#[must_use = "futures do nothing unless polled"]`

A future of an HTTP response.

```rust
pub struct ResponseFuture {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn stream_id(self: &Self) -> crate::StreamId { /* ... */ }
  ```
  Returns the stream ID of the response stream.

- ```rust
  pub fn push_promises(self: &mut Self) -> PushPromises { /* ... */ }
  ```
  Returns a stream of PushPromises

###### Trait Implementations

- **Unpin**
- **TryFuture**
  - ```rust
    fn try_poll(self: Pin<&mut F>, cx: &mut Context<''_>) -> Poll<<F as Future>::Output> { /* ... */ }
    ```

- **Freeze**
- **RefUnwindSafe**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Future**
  - ```rust
    fn poll(self: Pin<&mut Self>, cx: &mut Context<''_>) -> Poll<<Self as >::Output> { /* ... */ }
    ```

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **IntoFuture**
  - ```rust
    fn into_future(self: Self) -> <F as IntoFuture>::IntoFuture { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **UnwindSafe**
- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **WithSubscriber**
- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Send**
- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Sync**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **Instrument**
#### Struct `PushedResponseFuture`

**Attributes:**

- `#[must_use = "futures do nothing unless polled"]`

A future of a pushed HTTP response.

We have to differentiate between pushed and non pushed because of the spec
<https://httpwg.org/specs/rfc7540.html#PUSH_PROMISE>
> PUSH_PROMISE frames MUST only be sent on a peer-initiated stream
> that is in either the "open" or "half-closed (remote)" state.

```rust
pub struct PushedResponseFuture {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn stream_id(self: &Self) -> crate::StreamId { /* ... */ }
  ```
  Returns the stream ID of the response stream.

###### Trait Implementations

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Send**
- **WithSubscriber**
- **RefUnwindSafe**
- **UnwindSafe**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Instrument**
- **Future**
  - ```rust
    fn poll(self: Pin<&mut Self>, cx: &mut Context<''_>) -> Poll<<Self as >::Output> { /* ... */ }
    ```

- **Sync**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **TryFuture**
  - ```rust
    fn try_poll(self: Pin<&mut F>, cx: &mut Context<''_>) -> Poll<<F as Future>::Output> { /* ... */ }
    ```

- **Unpin**
- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Freeze**
- **IntoFuture**
  - ```rust
    fn into_future(self: Self) -> <F as IntoFuture>::IntoFuture { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

#### Struct `PushPromise`

A pushed response and corresponding request headers

```rust
pub struct PushPromise {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn request(self: &Self) -> &Request<()> { /* ... */ }
  ```
  Returns a reference to the push promise's request headers.

- ```rust
  pub fn request_mut(self: &mut Self) -> &mut Request<()> { /* ... */ }
  ```
  Returns a mutable reference to the push promise's request headers.

- ```rust
  pub fn into_parts(self: Self) -> (Request<()>, PushedResponseFuture) { /* ... */ }
  ```
  Consumes `self`, returning the push promise's request headers and

###### Trait Implementations

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **Sync**
- **Send**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **Instrument**
- **UnwindSafe**
- **Freeze**
- **RefUnwindSafe**
- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **WithSubscriber**
- **Unpin**
#### Struct `PushPromises`

**Attributes:**

- `#[must_use = "streams do nothing unless polled"]`

A stream of pushed responses and corresponding promised requests

```rust
pub struct PushPromises {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub async fn push_promise(self: &mut Self) -> Option<Result<PushPromise, crate::Error>> { /* ... */ }
  ```
  Get the next `PushPromise`.

###### Trait Implementations

- **Sync**
- **Unpin**
- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Freeze**
- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **RefUnwindSafe**
- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Send**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **WithSubscriber**
- **UnwindSafe**
- **Instrument**
- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

#### Struct `Builder`

Builds client connections with custom configuration values.

Methods can be chained in order to set the configuration values.

The client is constructed by calling [`handshake`] and passing the I/O
handle that will back the HTTP/2 server.

New instances of `Builder` are obtained via [`Builder::new`].

See function level documentation for details on the various client
configuration settings.

[`Builder::new`]: struct.Builder.html#method.new
[`handshake`]: struct.Builder.html#method.handshake

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::client::*;
# use bytes::Bytes;
#
# async fn doc<T: AsyncRead + AsyncWrite + Unpin>(my_io: T)
    -> Result<((SendRequest<Bytes>, Connection<T, Bytes>)), h2::Error>
# {
// `client_fut` is a future representing the completion of the HTTP/2
// handshake.
let client_fut = Builder::new()
    .initial_window_size(1_000_000)
    .max_concurrent_streams(1000)
    .handshake(my_io);
# client_fut.await
# }
#
# pub fn main() {}
```

```rust
pub struct Builder {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn new() -> Builder { /* ... */ }
  ```
  Returns a new client builder instance initialized with default

- ```rust
  pub fn initial_window_size(self: &mut Self, size: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the initial window size (in octets) for stream-level

- ```rust
  pub fn initial_connection_window_size(self: &mut Self, size: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the initial window size (in octets) for connection-level flow control

- ```rust
  pub fn max_frame_size(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the size (in octets) of the largest HTTP/2 frame payload that the

- ```rust
  pub fn max_header_list_size(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Sets the max size of received header frames.

- ```rust
  pub fn max_concurrent_streams(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of concurrent streams.

- ```rust
  pub fn initial_max_send_streams(self: &mut Self, initial: usize) -> &mut Self { /* ... */ }
  ```
  Sets the initial maximum of locally initiated (send) streams.

- ```rust
  pub fn max_concurrent_reset_streams(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of concurrent locally reset streams.

- ```rust
  pub fn reset_stream_duration(self: &mut Self, dur: Duration) -> &mut Self { /* ... */ }
  ```
  Sets the duration to remember locally reset streams.

- ```rust
  pub fn max_local_error_reset_streams(self: &mut Self, max: Option<usize>) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of local resets due to protocol errors made by the remote end.

- ```rust
  pub fn max_pending_accept_reset_streams(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of pending-accept remotely-reset streams.

- ```rust
  pub fn max_send_buffer_size(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum send buffer size per stream.

- ```rust
  pub fn enable_push(self: &mut Self, enabled: bool) -> &mut Self { /* ... */ }
  ```
  Enables or disables server push promises.

- ```rust
  pub fn header_table_size(self: &mut Self, size: u32) -> &mut Self { /* ... */ }
  ```
  Sets the header table size.

- ```rust
  pub fn handshake<T, B>(self: &Self, io: T) -> impl Future<Output = Result<(SendRequest<B>, Connection<T, B>), crate::Error>>
where
    T: AsyncRead + AsyncWrite + Unpin,
    B: Buf { /* ... */ }
  ```
  Creates a new configured HTTP/2 client backed by `io`.

###### Trait Implementations

- **Send**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **CloneToUninit**
  - ```rust
    unsafe fn clone_to_uninit(self: &Self, dest: *mut u8) { /* ... */ }
    ```

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **ToOwned**
  - ```rust
    fn to_owned(self: &Self) -> T { /* ... */ }
    ```

  - ```rust
    fn clone_into(self: &Self, target: &mut T) { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **RefUnwindSafe**
- **UnwindSafe**
- **Freeze**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Sync**
- **Unpin**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Clone**
  - ```rust
    fn clone(self: &Self) -> Builder { /* ... */ }
    ```

- **Instrument**
- **WithSubscriber**
- **Default**
  - ```rust
    fn default() -> Builder { /* ... */ }
    ```

### Functions

#### Function `handshake`

Creates a new configured HTTP/2 client with default configuration
values backed by `io`.

It is expected that `io` already be in an appropriate state to commence
the [HTTP/2 handshake]. See [Handshake] for more details.

Returns a future which resolves to the [`Connection`] / [`SendRequest`]
tuple once the HTTP/2 handshake has been completed. The returned
[`Connection`] instance will be using default configuration values. Use
[`Builder`] to customize the configuration values used by a [`Connection`]
instance.

[HTTP/2 handshake]: http://httpwg.org/specs/rfc7540.html#ConnectionHeader
[Handshake]: ../index.html#handshake
[`Connection`]: struct.Connection.html
[`SendRequest`]: struct.SendRequest.html

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::client;
# use h2::client::*;
#
# async fn doc<T: AsyncRead + AsyncWrite + Unpin>(my_io: T) -> Result<(), h2::Error>
# {
let (send_request, connection) = client::handshake(my_io).await?;
// The HTTP/2 handshake has completed, now start polling
// `connection` and use `send_request` to send requests to the
// server.
# Ok(())
# }
#
# pub fn main() {}
```

```rust
pub async fn handshake<T>(io: T) -> Result<(SendRequest<bytes::Bytes>, Connection<T, bytes::Bytes>), crate::Error>
where
    T: AsyncRead + AsyncWrite + Unpin { /* ... */ }
```

## Module `ext`

Extensions specific to the HTTP/2 protocol.

```rust
pub mod ext { /* ... */ }
```

### Types

#### Struct `Protocol`

Represents the `:protocol` pseudo-header used by
the [Extended CONNECT Protocol].

[Extended CONNECT Protocol]: https://datatracker.ietf.org/doc/html/rfc8441#section-4

```rust
pub struct Protocol {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub const fn from_static(value: &''static str) -> Self { /* ... */ }
  ```
  Converts a static string to a protocol name.

- ```rust
  pub fn as_str(self: &Self) -> &str { /* ... */ }
  ```
  Returns a str representation of the header.

###### Trait Implementations

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Send**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Instrument**
- **Eq**
- **CloneToUninit**
  - ```rust
    unsafe fn clone_to_uninit(self: &Self, dest: *mut u8) { /* ... */ }
    ```

- **Clone**
  - ```rust
    fn clone(self: &Self) -> Protocol { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **RefUnwindSafe**
- **StructuralPartialEq**
- **Freeze**
- **Unpin**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **ToOwned**
  - ```rust
    fn to_owned(self: &Self) -> T { /* ... */ }
    ```

  - ```rust
    fn clone_into(self: &Self, target: &mut T) { /* ... */ }
    ```

- **PartialEq**
  - ```rust
    fn eq(self: &Self, other: &Protocol) -> bool { /* ... */ }
    ```

- **UnwindSafe**
- **AsRef**
  - ```rust
    fn as_ref(self: &Self) -> &[u8] { /* ... */ }
    ```

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

  - ```rust
    fn from(value: &''a str) -> Self { /* ... */ }
    ```

- **Equivalent**
  - ```rust
    fn equivalent(self: &Self, key: &K) -> bool { /* ... */ }
    ```

  - ```rust
    fn equivalent(self: &Self, key: &K) -> bool { /* ... */ }
    ```

- **WithSubscriber**
- **Sync**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

## Module `server`

Server implementation of the HTTP/2 protocol.

# Getting started

Running an HTTP/2 server requires the caller to manage accepting the
connections as well as getting the connections to a state that is ready to
begin the HTTP/2 handshake. See [here](../index.html#handshake) for more
details.

This could be as basic as using Tokio's [`TcpListener`] to accept
connections, but usually it means using either ALPN or HTTP/1.1 protocol
upgrades.

Once a connection is obtained, it is passed to [`handshake`],
which will begin the [HTTP/2 handshake]. This returns a future that
completes once the handshake process is performed and HTTP/2 streams may
be received.

[`handshake`] uses default configuration values. There are a number of
settings that can be changed by using [`Builder`] instead.

# Inbound streams

The [`Connection`] instance is used to accept inbound HTTP/2 streams. It
does this by implementing [`futures::Stream`]. When a new stream is
received, a call to [`Connection::accept`] will return `(request, response)`.
The `request` handle (of type [`http::Request<RecvStream>`]) contains the
HTTP request head as well as provides a way to receive the inbound data
stream and the trailers. The `response` handle (of type [`SendResponse`])
allows responding to the request, stream the response payload, send
trailers, and send push promises.

The send ([`SendStream`]) and receive ([`RecvStream`]) halves of the stream
can be operated independently.

# Managing the connection

The [`Connection`] instance is used to manage connection state. The caller
is required to call either [`Connection::accept`] or
[`Connection::poll_close`] in order to advance the connection state. Simply
operating on [`SendStream`] or [`RecvStream`] will have no effect unless the
connection state is advanced.

It is not required to call **both** [`Connection::accept`] and
[`Connection::poll_close`]. If the caller is ready to accept a new stream,
then only [`Connection::accept`] should be called. When the caller **does
not** want to accept a new stream, [`Connection::poll_close`] should be
called.

The [`Connection`] instance should only be dropped once
[`Connection::poll_close`] returns `Ready`. Once [`Connection::accept`]
returns `Ready(None)`, there will no longer be any more inbound streams. At
this point, only [`Connection::poll_close`] should be called.

# Shutting down the server

Graceful shutdown of the server is [not yet
implemented](https://github.com/hyperium/h2/issues/69).

# Example

A basic HTTP/2 server example that runs over TCP and assumes [prior
knowledge], i.e. both the client and the server assume that the TCP socket
will use the HTTP/2 protocol without prior negotiation.

```no_run
use h2::server;
use http::{Response, StatusCode};
use tokio::net::TcpListener;

#[tokio::main]
pub async fn main() {
    let mut listener = TcpListener::bind("127.0.0.1:5928").await.unwrap();

    // Accept all incoming TCP connections.
    loop {
        if let Ok((socket, _peer_addr)) = listener.accept().await {
            // Spawn a new task to process each connection.
            tokio::spawn(async {
                // Start the HTTP/2 connection handshake
                let mut h2 = server::handshake(socket).await.unwrap();
                // Accept all inbound HTTP/2 streams sent over the
                // connection.
                while let Some(request) = h2.accept().await {
                    let (request, mut respond) = request.unwrap();
                    println!("Received request: {:?}", request);

                    // Build a response with no body
                    let response = Response::builder()
                        .status(StatusCode::OK)
                        .body(())
                        .unwrap();

                    // Send the response back to the client
                    respond.send_response(response, true)
                        .unwrap();
                }

            });
        }
    }
}
```

[prior knowledge]: http://httpwg.org/specs/rfc7540.html#known-http
[`handshake`]: fn.handshake.html
[HTTP/2 handshake]: http://httpwg.org/specs/rfc7540.html#ConnectionHeader
[`Builder`]: struct.Builder.html
[`Connection`]: struct.Connection.html
[`Connection::poll`]: struct.Connection.html#method.poll
[`Connection::poll_close`]: struct.Connection.html#method.poll_close
[`futures::Stream`]: https://docs.rs/futures/0.1/futures/stream/trait.Stream.html
[`http::Request<RecvStream>`]: ../struct.RecvStream.html
[`RecvStream`]: ../struct.RecvStream.html
[`SendStream`]: ../struct.SendStream.html
[`TcpListener`]: https://docs.rs/tokio-core/0.1/tokio_core/net/struct.TcpListener.html

```rust
pub mod server { /* ... */ }
```

### Types

#### Struct `Handshake`

**Attributes:**

- `#[must_use = "futures do nothing unless polled"]`

In progress HTTP/2 connection handshake future.

This type implements `Future`, yielding a `Connection` instance once the
handshake has completed.

The handshake is completed once the connection preface is fully received
from the client **and** the initial settings frame is sent to the client.

The handshake future does not wait for the initial settings frame from the
client.

See [module] level docs for more details.

[module]: index.html

```rust
pub struct Handshake<T, B: Buf = bytes::Bytes> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Trait Implementations

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Send**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Unpin**
- **TryFuture**
  - ```rust
    fn try_poll(self: Pin<&mut F>, cx: &mut Context<''_>) -> Poll<<F as Future>::Output> { /* ... */ }
    ```

- **RefUnwindSafe**
- **WithSubscriber**
- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, fmt: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **IntoFuture**
  - ```rust
    fn into_future(self: Self) -> <F as IntoFuture>::IntoFuture { /* ... */ }
    ```

- **Future**
  - ```rust
    fn poll(self: Pin<&mut Self>, cx: &mut Context<''_>) -> Poll<<Self as >::Output> { /* ... */ }
    ```

- **Instrument**
- **Freeze**
- **Sync**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **UnwindSafe**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

#### Struct `Connection`

**Attributes:**

- `#[must_use = "streams do nothing unless polled"]`

Accepts inbound HTTP/2 streams on a connection.

A `Connection` is backed by an I/O resource (usually a TCP socket) and
implements the HTTP/2 server logic for that connection. It is responsible
for receiving inbound streams initiated by the client as well as driving the
internal state forward.

`Connection` values are created by calling [`handshake`]. Once a
`Connection` value is obtained, the caller must call [`poll`] or
[`poll_close`] in order to drive the internal connection state forward.

See [module level] documentation for more details

[module level]: index.html
[`handshake`]: struct.Connection.html#method.handshake
[`poll`]: struct.Connection.html#method.poll
[`poll_close`]: struct.Connection.html#method.poll_close

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::server;
# use h2::server::*;
#
# async fn doc<T: AsyncRead + AsyncWrite + Unpin>(my_io: T) {
let mut server = server::handshake(my_io).await.unwrap();
while let Some(request) = server.accept().await {
    tokio::spawn(async move {
        let (request, respond) = request.unwrap();
        // Process the request and send the response back to the client
        // using `respond`.
    });
}
# }
#
# pub fn main() {}
```

```rust
pub struct Connection<T, B: Buf> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub async fn accept(self: &mut Self) -> Option<Result<(Request<RecvStream>, SendResponse<B>), crate::Error>> { /* ... */ }
  ```
  Accept the next incoming request on this connection.

- ```rust
  pub fn set_target_window_size(self: &mut Self, size: u32) { /* ... */ }
  ```
  Sets the target window size for the whole connection.

- ```rust
  pub fn set_initial_window_size(self: &mut Self, size: u32) -> Result<(), crate::Error> { /* ... */ }
  ```
  Set a new `INITIAL_WINDOW_SIZE` setting (in octets) for stream-level

- ```rust
  pub fn enable_connect_protocol(self: &mut Self) -> Result<(), crate::Error> { /* ... */ }
  ```
  Enables the [extended CONNECT protocol].

- ```rust
  pub fn poll_closed(self: &mut Self, cx: &mut Context<''_>) -> Poll<Result<(), crate::Error>> { /* ... */ }
  ```
  Returns `Ready` when the underlying connection has closed.

- ```rust
  pub fn abrupt_shutdown(self: &mut Self, reason: Reason) { /* ... */ }
  ```
  Sets the connection to a GOAWAY state.

- ```rust
  pub fn graceful_shutdown(self: &mut Self) { /* ... */ }
  ```
  Starts a [graceful shutdown][1] process.

- ```rust
  pub fn ping_pong(self: &mut Self) -> Option<PingPong> { /* ... */ }
  ```
  Takes a `PingPong` instance from the connection.

- ```rust
  pub fn has_streams(self: &Self) -> bool { /* ... */ }
  ```
  Checks if there are any streams

- ```rust
  pub fn max_concurrent_send_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the maximum number of concurrent streams that may be initiated

- ```rust
  pub fn max_concurrent_recv_streams(self: &Self) -> usize { /* ... */ }
  ```
  Returns the maximum number of concurrent streams that may be initiated

###### Trait Implementations

- **Sync**
- **Instrument**
- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **Send**
- **Unpin**
- **UnwindSafe**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **RefUnwindSafe**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, fmt: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **Freeze**
- **WithSubscriber**
#### Struct `Builder`

Builds server connections with custom configuration values.

Methods can be chained in order to set the configuration values.

The server is constructed by calling [`handshake`] and passing the I/O
handle that will back the HTTP/2 server.

New instances of `Builder` are obtained via [`Builder::new`].

See function level documentation for details on the various server
configuration settings.

[`Builder::new`]: struct.Builder.html#method.new
[`handshake`]: struct.Builder.html#method.handshake

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::server::*;
#
# fn doc<T: AsyncRead + AsyncWrite + Unpin>(my_io: T)
# -> Handshake<T>
# {
// `server_fut` is a future representing the completion of the HTTP/2
// handshake.
let server_fut = Builder::new()
    .initial_window_size(1_000_000)
    .max_concurrent_streams(1000)
    .handshake(my_io);
# server_fut
# }
#
# pub fn main() {}
```

```rust
pub struct Builder {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn new() -> Builder { /* ... */ }
  ```
  Returns a new server builder instance initialized with default

- ```rust
  pub fn initial_window_size(self: &mut Self, size: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the initial window size (in octets) for stream-level

- ```rust
  pub fn initial_connection_window_size(self: &mut Self, size: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the initial window size (in octets) for connection-level flow control

- ```rust
  pub fn max_frame_size(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Indicates the size (in octets) of the largest HTTP/2 frame payload that the

- ```rust
  pub fn max_header_list_size(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Sets the max size of received header frames.

- ```rust
  pub fn max_concurrent_streams(self: &mut Self, max: u32) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of concurrent streams.

- ```rust
  pub fn max_concurrent_reset_streams(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of concurrent locally reset streams.

- ```rust
  pub fn max_local_error_reset_streams(self: &mut Self, max: Option<usize>) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of local resets due to protocol errors made by the remote end.

- ```rust
  pub fn max_pending_accept_reset_streams(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of pending-accept remotely-reset streams.

- ```rust
  pub fn max_send_buffer_size(self: &mut Self, max: usize) -> &mut Self { /* ... */ }
  ```
  Sets the maximum send buffer size per stream.

- ```rust
  pub fn reset_stream_duration(self: &mut Self, dur: Duration) -> &mut Self { /* ... */ }
  ```
  Sets the maximum number of concurrent locally reset streams.

- ```rust
  pub fn enable_connect_protocol(self: &mut Self) -> &mut Self { /* ... */ }
  ```
  Enables the [extended CONNECT protocol].

- ```rust
  pub fn handshake<T, B>(self: &Self, io: T) -> Handshake<T, B>
where
    T: AsyncRead + AsyncWrite + Unpin,
    B: Buf { /* ... */ }
  ```
  Creates a new configured HTTP/2 server backed by `io`.

###### Trait Implementations

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **WithSubscriber**
- **Default**
  - ```rust
    fn default() -> Builder { /* ... */ }
    ```

- **Freeze**
- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Clone**
  - ```rust
    fn clone(self: &Self) -> Builder { /* ... */ }
    ```

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **RefUnwindSafe**
- **Unpin**
- **Send**
- **ToOwned**
  - ```rust
    fn to_owned(self: &Self) -> T { /* ... */ }
    ```

  - ```rust
    fn clone_into(self: &Self, target: &mut T) { /* ... */ }
    ```

- **UnwindSafe**
- **Sync**
- **CloneToUninit**
  - ```rust
    unsafe fn clone_to_uninit(self: &Self, dest: *mut u8) { /* ... */ }
    ```

- **Instrument**
- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

#### Struct `SendResponse`

Send a response back to the client

A `SendResponse` instance is provided when receiving a request and is used
to send the associated response back to the client. It is also used to
explicitly reset the stream with a custom reason.

It will also be used to initiate push promises linked with the associated
stream.

If the `SendResponse` instance is dropped without sending a response, then
the HTTP/2 stream will be reset.

See [module] level docs for more details.

[module]: index.html

```rust
pub struct SendResponse<B: Buf> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn send_response(self: &mut Self, response: Response<()>, end_of_stream: bool) -> Result<SendStream<B>, crate::Error> { /* ... */ }
  ```
  Send a response to a client request.

- ```rust
  pub fn push_request(self: &mut Self, request: Request<()>) -> Result<SendPushedResponse<B>, crate::Error> { /* ... */ }
  ```
  Push a request and response to the client

- ```rust
  pub fn send_reset(self: &mut Self, reason: Reason) { /* ... */ }
  ```
  Send a stream reset to the peer.

- ```rust
  pub fn poll_reset(self: &mut Self, cx: &mut Context<''_>) -> Poll<Result<Reason, crate::Error>> { /* ... */ }
  ```
  Polls to be notified when the client resets this stream.

- ```rust
  pub fn stream_id(self: &Self) -> crate::StreamId { /* ... */ }
  ```
  Returns the stream ID of the response stream.

###### Trait Implementations

- **Send**
- **Sync**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut $crate::fmt::Formatter<''_>) -> $crate::fmt::Result { /* ... */ }
    ```

- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **RefUnwindSafe**
- **Unpin**
- **Freeze**
- **WithSubscriber**
- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **UnwindSafe**
- **Instrument**
#### Struct `SendPushedResponse`

Send a response to a promised request

A `SendPushedResponse` instance is provided when promising a request and is used
to send the associated response to the client. It is also used to
explicitly reset the stream with a custom reason.

It can not be used to initiate push promises.

If the `SendPushedResponse` instance is dropped without sending a response, then
the HTTP/2 stream will be reset.

See [module] level docs for more details.

[module]: index.html

```rust
pub struct SendPushedResponse<B: Buf> {
    // Some fields omitted
}
```

##### Fields

| Name | Type | Documentation |
|------|------|---------------|
| *private fields* | ... | *Some fields have been omitted* |

##### Implementations

###### Methods

- ```rust
  pub fn send_response(self: &mut Self, response: Response<()>, end_of_stream: bool) -> Result<SendStream<B>, crate::Error> { /* ... */ }
  ```
  Send a response to a promised request.

- ```rust
  pub fn send_reset(self: &mut Self, reason: Reason) { /* ... */ }
  ```
  Send a stream reset to the peer.

- ```rust
  pub fn poll_reset(self: &mut Self, cx: &mut Context<''_>) -> Poll<Result<Reason, crate::Error>> { /* ... */ }
  ```
  Polls to be notified when the client resets this stream.

- ```rust
  pub fn stream_id(self: &Self) -> crate::StreamId { /* ... */ }
  ```
  Returns the stream ID of the response stream.

###### Trait Implementations

- **TryInto**
  - ```rust
    fn try_into(self: Self) -> Result<U, <U as TryFrom<T>>::Error> { /* ... */ }
    ```

- **Send**
- **RefUnwindSafe**
- **WithSubscriber**
- **From**
  - ```rust
    fn from(t: T) -> T { /* ... */ }
    ```
    Returns the argument unchanged.

- **Instrument**
- **Borrow**
  - ```rust
    fn borrow(self: &Self) -> &T { /* ... */ }
    ```

- **Freeze**
- **TryFrom**
  - ```rust
    fn try_from(value: U) -> Result<T, <T as TryFrom<U>>::Error> { /* ... */ }
    ```

- **Sync**
- **Any**
  - ```rust
    fn type_id(self: &Self) -> TypeId { /* ... */ }
    ```

- **Debug**
  - ```rust
    fn fmt(self: &Self, f: &mut fmt::Formatter<''_>) -> fmt::Result { /* ... */ }
    ```

- **Into**
  - ```rust
    fn into(self: Self) -> U { /* ... */ }
    ```
    Calls `U::from(self)`.

- **Unpin**
- **BorrowMut**
  - ```rust
    fn borrow_mut(self: &mut Self) -> &mut T { /* ... */ }
    ```

- **UnwindSafe**
### Functions

#### Function `handshake`

Creates a new configured HTTP/2 server with default configuration
values backed by `io`.

It is expected that `io` already be in an appropriate state to commence
the [HTTP/2 handshake]. See [Handshake] for more details.

Returns a future which resolves to the [`Connection`] instance once the
HTTP/2 handshake has been completed. The returned [`Connection`]
instance will be using default configuration values. Use [`Builder`] to
customize the configuration values used by a [`Connection`] instance.

[HTTP/2 handshake]: http://httpwg.org/specs/rfc7540.html#ConnectionHeader
[Handshake]: ../index.html#handshake
[`Connection`]: struct.Connection.html

# Examples

```
# use tokio::io::{AsyncRead, AsyncWrite};
# use h2::server;
# use h2::server::*;
#
# async fn doc<T: AsyncRead + AsyncWrite + Unpin>(my_io: T)
# {
let connection = server::handshake(my_io).await.unwrap();
// The HTTP/2 handshake has completed, now use `connection` to
// accept inbound HTTP/2 streams.
# }
#
# pub fn main() {}
```

```rust
pub fn handshake<T>(io: T) -> Handshake<T, bytes::Bytes>
where
    T: AsyncRead + AsyncWrite + Unpin { /* ... */ }
```

## Re-exports

### Re-export `Error`

```rust
pub use crate::error::Error;
```

### Re-export `Reason`

```rust
pub use crate::error::Reason;
```

### Re-export `FlowControl`

```rust
pub use crate::share::FlowControl;
```

### Re-export `Ping`

```rust
pub use crate::share::Ping;
```

### Re-export `PingPong`

```rust
pub use crate::share::PingPong;
```

### Re-export `Pong`

```rust
pub use crate::share::Pong;
```

### Re-export `RecvStream`

```rust
pub use crate::share::RecvStream;
```

### Re-export `SendStream`

```rust
pub use crate::share::SendStream;
```

### Re-export `StreamId`

```rust
pub use crate::share::StreamId;
```

